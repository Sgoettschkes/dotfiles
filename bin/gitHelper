#!/bin/sh

set -o nounset
set -o errexit

CurrentBranch=`git branch | awk '/^\*/{print $2}'`
CurrentDir=`pwd`
GitBaseDir=`git rev-parse --show-toplevel`

if [ $# -ne 1 ]; then
    echo "No argument given"
    exit
fi

up () {
    git checkout master
    if [ $? -ne 0 ]; then
        exit
    fi
    
    git rebase $CurrentBranch
    if [ $? -ne 0 ]; then
        git checkout $CurrentBranch
        exit
    fi
    
    git push origin master
    if [ $? -ne 0 ]; then
        exit
    fi
    
    git checkout $CurrentBranch
    if [ $? -ne 0 ]; then
        exit
    fi
}

down () {
    git checkout master
    if [ $? -ne 0 ]; then
        exit
    fi

    git pull --rebase origin master
    git checkout $CurrentBranch
    if [ $? -ne 0 ]; then
        exit
    fi

    git rebase master
    if [ $? -ne 0 ]; then
        exit
    fi
}

if [ "$1" = "up" ]; then
    cd $GitBaseDir
    up
    cd $CurrentDir
elif [ "$1" = "down" ]; then
    cd $GitBaseDir
    down
    cd $CurrentDir
fi

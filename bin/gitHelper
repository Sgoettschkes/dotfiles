#!/bin/sh
set -o nounset
set -o errexit

CURRENT_BRANCH=`git branch | awk '/^\*/{print $2}'`
CURRENT_DIR=`pwd`
GIT_BASE_DIR=`git rev-parse --show-toplevel`

if [ $# -ne 1 ]; then
    echo "No argument given"
    exit
fi

up () {
    git checkout master
    if [ $? -ne 0 ]; then
        exit
    fi
    
    git rebase $CURRENT_BRANCH
    if [ $? -ne 0 ]; then
        git checkout $CURRENT_BRANCH
        exit
    fi
    
    git push origin master
    if [ $? -ne 0 ]; then
        exit
    fi
    
    git checkout $CURRENT_BRANCH
    if [ $? -ne 0 ]; then
        exit
    fi
}

down () {
    git checkout master
    if [ $? -ne 0 ]; then
        exit
    fi

    git pull --rebase origin master
    git checkout $CURRENT_BRANCH
    if [ $? -ne 0 ]; then
        exit
    fi

    git rebase master
    if [ $? -ne 0 ]; then
        exit
    fi
}

if [ "$1" = "up" ]; then
    cd $GIT_BASE_DIR
    up
    cd $CURRENT_DIR
elif [ "$1" = "down" ]; then
    cd $GIT_BASE_DIR
    down
    cd $CURRENT_DIR
fi

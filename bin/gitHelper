#!/bin/sh

set -o nounset
set -o errexit

readonly Progname=$(basename "$0")
readonly Progdir=$(readlink -m $(dirname "$0"))
readonly Args="$@"

readonly CurrentDir=`pwd`
readonly GitCurrentBranch=`git branch | awk '/^\*/{print $2}'`
readonly GitBaseDir=`git rev-parse --show-toplevel`

main () {
    local readonly Task=${1:-down}
    local readonly GitTargetBranch=${2:-master}

    up () {
        git checkout $GitTargetBranch
        git rebase $GitCurrentBranch
        git push origin $GitTargetBranch
        git checkout $GitCurrentBranch
    }

    down () {
        git checkout $GitTargetBranch
        git pull --rebase origin $GitTargetBranch
        git checkout $GitCurrentBranch
        git rebase $GitTargetBranch
    }

    cd $GitBaseDir
    $Task
    cd $CurrentDir
}
main $Args
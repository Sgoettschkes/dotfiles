#!/bin/bash

# File managed by Sgoettschkes/dotfiles
# Do not change

set -o nounset
set -o errexit

readonly Progname=$(basename "${0}")
readonly Progdir=$(readlink -m $(dirname "${0}"))
readonly Args="$@"

# Helpers for printing stuff
success () { printf "\e[32m$1\e[39m\n"; }
warning () { printf "\e[33m$1\e[39m\n"; }
error () { printf "\e[31m$1\e[39m\n"; }

main () {
    local readonly Action=${1:-next}

    local readonly GitBaseDir=`git rev-parse --show-toplevel`
    local readonly IterFile="$GitBaseDir/.git/iter"

    if [ "$Action" == "start" ]; then
        if [ -f $IterFile ]; then
            error "git iter was not stopped properly. Run git iter stop"
        fi

        local readonly Target=${2:-HEAD}
        git rev-list $Target..HEAD > $IterFile
        git checkout $Target
    elif [ "$Action" == "next" ]; then
        local readonly Target=`tail -n 1 $IterFile`
        sed -i '$ d' $IterFile
        git checkout $Target
    elif [ "$Action" == "stop" ]; then
        rm $IterFile
        git checkout master
    fi
}
main ${Args}


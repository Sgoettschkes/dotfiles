#!/bin/bash

# File managed by Sgoettschkes/dotfiles
# Do not change

set -o nounset
set -o errexit

readonly Progname=$(basename "$0")
readonly Progdir=$(readlink -m $(dirname "$0"))
readonly Args="$@"

# Helpers for printing stuff
success () { printf "\e[32m$1\e[39m\n"; }
warning () { printf "\e[33m$1\e[39m\n"; }
error () { printf "\e[31m$1\e[39m\n"; }

main () {
    local readonly Sessionname=${1:-seg}

    if [[ "$TERM" == "screen-256color" ]]; then
        error "segmux cannot run inside tmux"
        exit;
    fi

    if tmux has-session -t $Sessionname; then
        tmux attach -t $Sessionname
        exit
    fi

    tmux new-session -s $Sessionname -n sh -d
    tmux send-keys -t $Sessionname:1.1 'cd ~; clear' C-m
    tmux new-window -n vimwiki -t $Sessionname
    tmux split-window -t $Sessionname:2.1 -v
    tmux send-keys -t $Sessionname:2.1 'cd ~/workspace/Sgoettschkes/vimwiki; clear' C-m
    tmux send-keys -t $Sessionname:2.2 'cd ~/workspace/Sgoettschkes/vimwiki; clear' C-m
    tmux select-window -t $Sessionname:1

    tmux attach -t $Sessionname
}
main $Args
